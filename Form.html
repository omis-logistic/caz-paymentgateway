<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
    <style>
      :root {
        --gold: #D4AF37;
        --white: #FFFFFF;
        --text-dark: #333333;
      }

      * {
        box-sizing: border-box;
        -webkit-text-size-adjust: none;
        -webkit-overflow-scrolling: touch;
      }

      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        width: 100vw;
        overflow-x: hidden;
        background: var(--white);
        color: var(--text-dark);
        font-size: 14px;
        line-height: 1.4;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      .container {
        width: 100%;
        max-width: 100%;
        margin: 0 auto;
        flex: 1;
      }

      .header {
        background: var(--gold);
        padding: 15px;
        text-align: center;
        position: sticky;
        top: 0;
        width: 100%;
      }

      .content {
        padding: 15px;
        width: 100%;
      }

      .account-row {
        display: block;
        width: 100%;
      }

      #accNum {
        display: block;
        width: 100%;
        font-size: 16px;
        word-break: break-word;
        text-align: center;
        margin: 10px 0;
        padding: 12px;
        background: #FFFBE6;
        border: 1px solid var(--gold);
        border-radius: 4px;
      }

      .copy-btn, input[type="submit"] {
        display: block;
        width: 100%;
        background: var(--gold);
        color: white;
        border: none;
        padding: 12px;
        border-radius: 4px;
        margin: 10px 0;
        font-size: 16px;
      }

      input[type="file"] {
        display: block;
        width: 100%;
        padding: 12px;
        margin: 15px 0;
        border: 2px dashed var(--gold);
        background: #FFFBE6;
        border-radius: 4px;
      }

      @media (min-width: 768px) {
        body {
          padding: 20px;
          background: #f0f0f0;
          font-size: 16px;
        }

        .container {
          width: 600px;
          border-radius: 10px;
          box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        }

        .account-row {
          display: flex;
          gap: 15px;
          align-items: center;
        }

        #accNum {
          text-align: left;
          margin: 0;
        }

        .copy-btn {
          width: auto;
          min-width: 160px;
        }
      }
     
  /* Add these lines at the bottom of your existing styles */
  body {
    margin-top: -40px !important; /* Compensate for banner height */
  }
  
  /* Completely hide the banner */
  .ss-branding {
    display: none !important;
    height: 0 !important;
    visibility: hidden !important;
  }
  
  .ss-logo-container {
    display: none !important;
  }
      /* Banner Removal CSS */
    #warning {
      display: none !important;
      height: 0 !important;
      overflow: hidden !important;
    }
    
    body {
      margin-top: 0 !important;
    }

    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>Payment Gateway</h1>
      </div>
      
      <div class="content">
        <p><strong>Order Number:</strong> <?= orderNumber ?></p>
        <p><strong>Code:</strong> <?= orderData.code ?></p>
        <p><strong>Name:</strong> <?= orderData.name ?></p>
        <p><strong>Price:</strong> $<?= orderData.price ?></p>
        
        <hr>
        
        <h3>Payment Instructions</h3>
        <p style="color: var(--gold); font-weight: bold;">BIBD Transfer</p>
        <div class="account-row">
          <span id="accNum">00010010016466</span>
          <button class="copy-btn" onclick="copyToClipboard()">Copy Account Number</button>
        </div>
        
        <form id="paymentForm">
          <input type="hidden" name="orderNumber" value="<?= orderNumber ?>">
          <input type="hidden" name="code" value="<?= orderData.code ?>">
          <input type="hidden" name="name" value="<?= orderData.name ?>">
          <input type="hidden" name="price" value="<?= orderData.price ?>">
          <input type="hidden" name="branchPhone" value="<?= orderData.branchPhone ?>">
          
          <p>Upload payment screenshot:</p>
          <input type="file" name="uploadFile" accept="image/*" required>
          <input type="submit" value="Submit Payment">
        </form>
      </div>
    </div>

     <script>
    // ===== BANNER REMOVAL =====
    function killBanner() {
      try {
        const closeButton = document.querySelector("#warning > div.warning-banner-close-icon");
        if(closeButton) {
          closeButton.click();
          document.body.style.marginTop = "0";
          
          // Remove banner element completely
          const banner = document.getElementById("warning");
          if(banner) banner.remove();
        }
      } catch(error) {
        console.log("Banner already removed");
      }
    }

    // Triple-phase removal strategy
    window.addEventListener('DOMContentLoaded', () => {
      // Immediate removal
      killBanner();
      
      // Monitor DOM changes
      const observer = new MutationObserver((mutations) => {
        mutations.forEach(() => {
          if(document.querySelector("#warning")) {
            killBanner();
            observer.disconnect();
          }
        });
      });

      observer.observe(document.body, {
        childList: true,
        subtree: true
      });

      // Final cleanup after 1 second
      setTimeout(() => {
        killBanner();
        document.body.style.marginTop = "0";
        document.documentElement.style.overflow = "visible";
      }, 1000);
    });
    
      async function copyToClipboard() {
        try {
          await navigator.clipboard.writeText(document.getElementById('accNum').innerText);
          alert('Account number copied to clipboard!');
        } catch (err) {
          alert('Failed to copy! Please manually select the text.');
        }
      }

      document.getElementById('paymentForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const file = e.target.uploadFile.files[0];
        
        if (!file) {
          alert('Please select a payment screenshot first!');
          return;
        }

        // Show loading state
        const originalContent = document.body.innerHTML;
        document.body.innerHTML = `
          <div class="container">
            <div class="header">
              <h1>Processing Payment</h1>
            </div>
            <div class="content">
              <p>Please wait while we process your payment...</p>
            </div>
          </div>
        `;

        try {
          const data = await new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = (fileEvent) => {
              google.script.run
                .withSuccessHandler(resolve)
                .withFailureHandler(reject)
                .uploadFile({
                  upload: {
                    name: file.name,
                    data: fileEvent.target.result.split(',')[1],
                    contentType: file.type
                  },
                  orderNumber: '<?= orderNumber ?>',
                  code: '<?= orderData.code ?>',
                  name: '<?= orderData.name ?>',
                  price: '<?= orderData.price ?>',
                  branchPhone: '<?= orderData.branchPhone ?>'
                });
            };
            reader.readAsDataURL(file);
          });

          // Construct WhatsApp message
          const message = `Payment Confirmation
Order Number: ${data.orderNumber}
Code: ${data.code}
Name: ${data.name}
Price: $${data.price}
Screenshot: ${data.url}`;

          // Update confirmation display
          document.body.innerHTML = `
          <div class="container">
            <div class="header">
              <h1>Payment Confirmed</h1>
            </div>
            <div class="content">
              <p><strong>Order Number:</strong> ${data.orderNumber}</p>
              <p><strong>Code:</strong> ${data.code}</p>
              <p><strong>Name:</strong> ${data.name}</p>
              <p><strong>Price:</strong> $${data.price}</p>
              <p><strong>Screenshot:</strong> <a href="${data.url}" target="_blank">View Receipt</a></p>
              <button onclick="window.open('https://wa.me/${data.branchPhone}?text=${encodeURIComponent(message)}', '_blank')" 
                class="copy-btn">
          Send via WhatsApp
        </button>
      </div>
    </div>
          `;
        } catch (error) {
          alert('Error: ' + error.message);
          document.body.innerHTML = originalContent;
        }
      });
    </script>
  </body>
</html>
